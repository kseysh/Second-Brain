# 나의 풀이 (틀림)
```cpp
#include <string>
#include <vector>

#define MAX_N 100
#define COLUMN 0
#define BEAM 1
#define DELETE 0
#define INSTALL 1

using namespace std;

bool beams[MAX_N + 5][MAX_N + 5];
bool columns[MAX_N + 5][MAX_N + 5];
int n;

bool checkWalls(){
    for(int y = 0; y <= n; y++){
        for(int x = 0; x <= n; x++){
            if(columns[y][x]){
                // 기둥은 바닥위에 있으면 통과
                if(y == 0) continue;  
                // 다른 기둥 위에 있거나
                if(columns[y - 1][x]) continue;
                // 보의 한쪽 끝 부분위에 있어야 한다
                if(beams[y][x]) continue;
                if(x > 0 && beams[y][x - 1]) continue;    
                
                return false;
            }
            if(beams[y][x]){
                if(y == 0) return false; // 바닥에 보를 설치하지 않는다.
                // 보는 한쪽 끝 부분이 기둥 위에 있거나
                if(columns[y - 1][x]) continue;  
                if(columns[y - 1][x+1]) continue;
                
                // 양쪽 끝 부분이 다른 보와 동시에 연결되어 있어야 한다.
                if(x == 0) return false;
                if(beams[y][x-1] && beams[y][x+1]) continue;    
                
                return false; // 조건 불만족시 false
            }
        }
    }
    return true;
}

vector<vector<int>> solution(int nn, vector<vector<int>> build_frame) {
    n = nn;
    
    for (int i = 0; i <= n; i++) {
        for (int j = 0; j <= n; j++) {
            beams[i][j] = false;
            columns[i][j] = false;
        }
    }
    
    for(const vector<int> &v : build_frame){
        int x = v[0];
        int y = v[1];
        // if(!inRange(y, x)) continue; => inRange 검사 안함
        int type = cmd[2];
        int action = cmd[3];

        if(type == BEAM){
            if(action == INSTALL){
                beams[y][x] = true;
                if(!checkWalls()) beams[y][x] = false;
            }
            else {
                beams[y][x] = false;
                if(!checkWalls()) beams[y][x] = true;
            }
        }else{
            if(action == INSTALL){
                columns[y][x] = true;
                if(!checkWalls()) columns[y][x] = false;
            }
            else {
                columns[y][x] = false;
                if(!checkWalls()) columns[y][x] = true;
            }
        }   
    }
    
    vector<vector<int>> answer;
    
    for(int x = 0; x <= n; x++){
        for(int y = 0; y <= n; y++){
            if(columns[y][x])answer.push_back({x, y, COLUMN});
            if(beams[y][x]) answer.push_back({x, y, BEAM});
        }
    }
    
    return answer;
}
```
# 정답 코드
```cpp
#include <string>
#include <vector>
#include <algorithm>

#define COLUMN 0
#define BEAM 1
#define DELETE 0
#define INSTALL 1

using namespace std;

bool beams[105][105];
bool columns[105][105];
int n;

// 기둥이 유효한지 체크
bool isValidColumn(int x, int y) {
    // 바닥 위에 있는 경우
    if (y == 0) return true;
    
    // 다른 기둥 위에 있는 경우
    if (columns[x][y-1]) return true;
    
    // 보의 한쪽 끝 위에 있는 경우
    if (beams[x][y]) return true;
    if (x > 0 && beams[x-1][y]) return true;
    
    return false;
}

// 보가 유효한지 체크
bool isValidBeam(int x, int y) {
    if(y == 0) return false;
    // 한쪽 끝이 기둥 위에 있는 경우
    if (columns[x][y-1]) return true;
    if (columns[x+1][y-1]) return true;
    
    // 양쪽 끝이 다른 보와 연결된 경우
    if(x == 0) return false;
    if (beams[x-1][y] && beams[x+1][y]) return true;
    
    return false;
}

// 전체 구조물이 유효한지 체크
bool checkAll() {
    for (int x = 0; x <= n; x++) {
        for (int y = 0; y <= n; y++) {
            if (columns[x][y] && !isValidColumn(x, y)) return false;
            if (beams[x][y] && !isValidBeam(x, y)) return false;
        }
    }
    return true;
}

vector<vector<int>> solution(int nn, vector<vector<int>> build_frame) {
    n = nn;
    
    // 모든 구조물 초기화
    for (int i = 0; i <= n; i++) {
        for (int j = 0; j <= n; j++) {
            beams[i][j] = false;
            columns[i][j] = false;
        }
    }
    
    for (const vector<int>& cmd : build_frame) {
        int x = cmd[0];
        int y = cmd[1];
        int type = cmd[2];
        int action = cmd[3];
        
        if (type == COLUMN) {
            if (action == INSTALL) {
                // 기둥 설치
                columns[x][y] = true;
                if (!checkAll()) columns[x][y] = false;
                
            } else {
                // 기둥 삭제
                columns[x][y] = false;
                if (!checkAll()) columns[x][y] = true;
            }
        } else {
            if (action == INSTALL) {
                // 보 설치
                beams[x][y] = true;
                if (!checkAll()) beams[x][y] = false;
            } else {
                // 보 삭제
                beams[x][y] = false;
                if (!checkAll()) beams[x][y] = true;
            }
        }
    }
    
    vector<vector<int>> answer;
    
    // 결과 수집
    for (int x = 0; x <= n; x++) {
        for (int y = 0; y <= n; y++) {
            if (columns[x][y]) answer.push_back({x, y, COLUMN});
            if (beams[x][y]) answer.push_back({x, y, BEAM});
        }
    }
    
    return answer;
}
```