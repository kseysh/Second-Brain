# 정답 풀이
```cpp
#include <iostream>
#include <string>
#include <vector>
#include <string.h>
#define MAX_N 1005
#define INVALID -2
#define EMPTY -1
using namespace std;
int dp[MAX_N];
int firstAppear[256];
string sen;

bool isLower(char c) { return 'a' <= c && c <= 'z'; }
bool isUpper(char c) { return 'A' <= c && c <= 'Z'; }

bool isAllUpper(int first, int last) {
    if (first > last)
        return false;
    for (int i = first; i <= last; i++) {
        if (!isUpper(sen[i])) return false;
    }
    return true;
}

bool isRuleA(int first, int last) {
    if (first > last)
        return false;
    if ((last - first) % 2 == 1)
        return false;
    char c = '?';
    for (int i = first; i <= last; i++) {
        if ((i - first) % 2 == 1) {
            if (!isLower(sen[i]))
                return false;
            if (c == '?') {
                c = sen[i];
                if (firstAppear[c] < first)
                    return false;
            } else if (c != sen[i]) 
                return false;
        } else {
            if (!isUpper(sen[i])) 
                return false;
        }
    }
    return true;
}

bool isRuleB(int first, int last) {
    if (first >= last) 
        return false;
    return isLower(sen[first]) && sen[first] == sen[last] && firstAppear[sen[first]] == first;
}

bool canBeWord(int first, int last) {
    if (isRuleB(first, last)) {
        first++; 
        last--;
    }
    return isAllUpper(first, last) || isRuleA(first, last);
}

int getWordStart(int e) {
    if (e <= -1) return 0;
    if (dp[e] != EMPTY) return dp[e];
    dp[e] = INVALID;
    for (int s = 0; s <= e; s++) {
        if (canBeWord(s, e) && getWordStart(s - 1) != INVALID) {
            dp[e] = s;
            break;
        }
    }
    return dp[e];
}

void buildFirstAppear() { // 각 소문자 기호가 처음 등장한 인덱스를 기록
    memset(firstAppear, -1, sizeof(firstAppear));
    for (int i = 0; i < sen.size(); i++) {
        if (isLower(sen[i])) {
            if (firstAppear[sen[i]] == -1) {
                firstAppear[sen[i]] = i;
            }
        }
    }
}

string solution(string sentence) {
    sen = sentence;
    buildFirstAppear();
    memset(dp, EMPTY, sizeof(dp));
    getWordStart(sen.size() - 1);
    int i = sen.size() - 1;
    if (dp[i] == INVALID) return string("invalid");
    vector<int> spaces;
    while (true) {
        if (dp[i] == 0) 
            break;
        i = dp[i] - 1;
        spaces.push_back(i);
    }
    string answer;
    int j = spaces.size() - 1;
    for (int i = 0; i < sen.size(); i++) {
        if (isUpper(sen[i])) {
            answer += sen[i];
        }
        if (j >= 0 && spaces[j] == i) {
            answer += " ";
            j--;
        }
    }
    return answer;
}
```


# 나의 풀이
틀림..