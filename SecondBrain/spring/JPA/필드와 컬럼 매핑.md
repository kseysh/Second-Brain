# 매핑 어노테이션
## @Column 
컬럼 매핑
### 속성
![[Pasted image 20231012200107.png]]
# @Temporal 
날짜 타입 매핑
![[Pasted image 20231012200828.png]]
# @Enumerated enum 
타입 매핑 
![[Pasted image 20231012200320.png]]
> 꼭 EnumType.STRING으로 하기!

0번째 enum이 추가되어 원래의 enum값들이 숫자가 다 바뀌어도 데이터베이스에는 enum 순서가 바뀌지 않아 데이터가 잘못될 수 있다.
# @Lob 
BLOB, CLOB 매핑 
![[Pasted image 20231012200843.png]]
# @Transient
특정 필드를 컬럼에 매핑하지 않음(매핑 무시)

# @GeneratedValue
![[Pasted image 20231012201239.png]]
## IDENTITY 전략

DB에 값이 들어가야 ID값을 알 수 있다.
하지만 영속성 컨텍스트에서 관리되려면 항상 PK가 있어야 한다.
그래서 원래는 COMMIT시에 INSERT 쿼리가 날아가지만,  IDENTITY전략에서는 `em.persist(member)`를 하자마자 INSERT 쿼리가 날아간다.


![[Pasted image 20231012202455.png]]

![[Pasted image 20231012201316.png]]


## SEQUNCE 전략
### 매핑
![[Pasted image 20231012201646.png]]

![[Pasted image 20231012201732.png]]
### allocationSize 속성
시퀀스에서 한 번에 미리 할당할 기본 키 값의 수를 지정
일반적으로, 데이터베이스 시퀀스는 다음 기본 키 값을 미리 할당하여 효율적인 성능을 위해 여러 번 사용합니다. `allocationSize`를 설정함으로써, JPA는 데이터베이스 시퀀스로부터 한 번에 미리 할당된 기본 키 값의 수를 지정한 만큼 가져오고, 이러한 값들을 메모리에 보관하며 엔티티가 저장될 때마다 메모리에서 기본 키 값을 할당합니다. 이렇게 함으로써 데이터베이스와의 라운드트립(Round-Trip)을 줄이고 성능을 향상시킬 수 있다.
> 데이터베이스 시퀀스 값이 하나씩 증가하도록 설정되어 있으면 allocationSize를 반드시 1로 설정해야하는 이유:
> 1. 일관성: `allocationSize`를 1로 설정하면 시퀀스 값이 엔티티의 각 행마다 정확히 하나씩 증가합니다. 이는 엔티티의 기본 키 값이 항상 고유하고 중복되지 않도록 보장합니다.
> 2. 불필요한 미리 할당 방지: `allocationSize`를 1로 설정하면 데이터베이스는 한 번에 하나의 시퀀스 값을 할당합니다. 따라서 데이터베이스가 사용하지 않는 기본 키 값을 미리 할당하는 것을 방지할 수 있습니다.
> 3. 예측 가능한 동작: `allocationSize`를 1로 설정하면 엔티티가 저장될 때마다 시퀀스에서 증가된 값을 사용하므로 동작이 예측 가능하고 간단합니다. 이는 코드의 가독성을 향상시키고 유지 관리를 쉽게 만듭니다.
> 4. 불필요한 메모리 사용 방지: `allocationSize`를 큰 값으로 설정하면 메모리에 미리 할당된 기본 키 값들이 저장되고 엔티티 저장 시마다 사용됩니다. 그러나 `allocationSize`를 1로 설정하면 메모리에 적은 수의 값만 저장되므로 메모리 사용을 최적화할 수 있습니다.
    
2. 예측 가능한 동작: `allocationSize`를 1로 설정하면 엔티티가 저장될 때마다 시퀀스에서 증가된 값을 사용하므로 동작이 예측 가능하고 간단합니다. 이는 코드의 가독성을 향상시키고 유지 관리를 쉽게 만듭니다.
    
3. 불필요한 메모리 사용 방지: `allocationSize`를 큰 값으로 설정하면 메모리에 미리 할당된 기본 키 값들이 저장되고 엔티티 저장 시마다 사용됩니다. 그러나 `allocationSize`를 1로 설정하면 메모리에 적은 수의 값만 저장되므로 메모리 사용을 최적화할 수 있습니다.
    
2. 불필요한 미리 할당 방지: `allocationSize`를 1로 설정하면 데이터베이스는 한 번에 하나의 시퀀스 값을 할당합니다. 따라서 데이터베이스가 사용하지 않는 기본 키 값을 미리 할당하는 것을 방지할 수 있습니다.
    
3. 예측 가능한 동작: `allocationSize`를 1로 설정하면 엔티티가 저장될 때마다 시퀀스에서 증가된 값을 사용하므로 동작이 예측 가능하고 간단합니다. 이는 코드의 가독성을 향상시키고 유지 관리를 쉽게 만듭니다.
    
4. 불필요한 메모리 사용 방지: `allocationSize`를 큰 값으로 설정하면 메모리에 미리 할당된 기본 키 값들이 저장되고 엔티티 저장 시마다 사용됩니다. 그러나 `allocationSize`를 1로 설정하면 메모리에 적은 수의 값만 저장되므로 메모리 사용을 최적화할 수 있습니다.
    
2. 불필요한 미리 할당 방지: `allocationSize`를 1로 설정하면 데이터베이스는 한 번에 하나의 시퀀스 값을 할당합니다. 따라서 데이터베이스가 사용하지 않는 기본 키 값을 미리 할당하는 것을 방지할 수 있습니다.
    
3. 예측 가능한 동작: `allocationSize`를 1로 설정하면 엔티티가 저장될 때마다 시퀀스에서 증가된 값을 사용하므로 동작이 예측 가능하고 간단합니다. 이는 코드의 가독성을 향상시키고 유지 관리를 쉽게 만듭니다.
    
4. 불필요한 메모리 사용 방지: `allocationSize`를 큰 값으로 설정하면 메모리에 미리 할당된 기본 키 값들이 저장되고 엔티티 저장 시마다 사용됩니다. 그러나 `allocationSize`를 1로 설정하면 메모리에 적은 수의 값만 저장되므로 메모리 사용을 최적화할 수 있습니다.
    

요약하면, 데이터베이스
## TABLE 전략

>잘 사용하지는 않는다!

![[Pasted image 20231012201954.png]]

![[Pasted image 20231012202011.png]]
![[Pasted image 20231012202024.png]]

# 권장하는 식별자 전략
![[Pasted image 20231012202156.png]]
대체키 : SEQUENCE를 사용하거나 UUID를 사용하거 키 생성전략을 사용하는 것이 좋다. 비즈니스에 관련된 값을 PK로 사용하지 말자!

