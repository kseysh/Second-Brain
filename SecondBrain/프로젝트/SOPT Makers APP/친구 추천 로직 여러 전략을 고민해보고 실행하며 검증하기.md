이번에 SOPT Makers App팀 4기 3차 스프린트에서 익명 콕 찌르기 기능을 도입하면서 친구 추천 api 개선을 맡게 되었습니다. 
그동안은 친구 추천 로직이 같은 기수의 친구만을 추천했지만, 익명 기능이 추가되며 좀 더 여러 친구를 추천한다면 유저들이 콕 찌르기 기능을 더 잘 사용할 것이라는 기획으로 인해 친구 추천에 같은 MBTI, 같은 학교 추천이 들어가게 되었습니다.

SOPT에서는 목적 조직 형식으로 팀을 운영하고 있습니다. 저는 App팀이지만, 유저의 정보들은 playground팀에서 관리하고 있고 이 정보에 접근하기 위해서는 Playground 팀의 internal api가 필요해요

친구 추천 로직 개발 초기에는 기존 방식이었던 playground 팀의 internal api를 통해 멤버의 프로필을 조건에 맞는 유저로만 필터링 해 모두 가져와서 기존의 친구 관계를 맺는 유저를 제외한 후 랜덤으로 추천 로직을 돌렸습니다. 따라서 기존 방식과 비슷하게 같은 MBTI 별 추천, 같은 학교 추천도 같은 로직을 사용하도록 개발하였는데요

dev에서는 잘 돌아가던 이 녀석... prod 서버에 들어가게 되니 api 호출 속도가 현저히 느려졌습니다.
테스트 코드도 작성하고, postman으로 테스트도 해봤지만 dev에서의 테스트만으로는 prod의 모든 문제를 잡을 수 없다는 것을 느꼈어요.

dev의 playground api에서 반환되던 유저 정보의 양과 prod의 api에서 반환되는 유저 정보의 양이 다르다보니 발생한 문제인데요, 제 api의 속도만 고려했지 외부 api에서 여러 정보를 요구하다보니 외부 api에서 발생하는 부하는 고려하지 못했습니다. 따라서 prod 서버의 친구 추천 로직의 응답 시간이 많이 길어지고, 심지어는 가끔 timeout이 발생하여 기능이 작동하지 않기도 했어요.

기능이 작동하지 않는 이유는 다음과 같았습니다.
- 친구 추천 api를 한 번 돌릴 때 마다playground api의 추천된 친구 반환 정보가 많아 playground 서버가 부하를 감당하기 어려움 (게다가 친구 추천 api는 자신이 원하는 친구를 찾기 위해 재 호출이 잦은 api예요)

따라서 해결 방식으로 세 가지 정도를 생각해보았습니다
- playground에게 조건에 맞는 필터링 후 유저의 모든 정보를 반환하는 것이 아닌, 유저의 id만 제공하는 internal api를 요청한다.
	- playground api를 이용해 필터링된 유저의 id만을 가져온 후 App 팀 내부에서의 비즈니스 로직을 돌려서 추천 대상인 유저의 id를 랜덤으로 2명씩 뽑는다.
	- 추천된 친구의 id를 playground에서 id를 통해 프로필을 가져오는 api를 이용해 추천된 친구만 프로필을 가져오도록 한다.
- playground의 멤버 프로필 조회 api를 친구 추천 로직을  response를 캐싱하여 사용한다.
- 

