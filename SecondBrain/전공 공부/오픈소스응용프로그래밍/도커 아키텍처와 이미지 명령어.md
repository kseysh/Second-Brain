
# 도커 아키텍처
- 도커는 클라이언트-서버 아키텍처를 사용
### 도커 데몬
- 도커 API요청을 수신하고 이미지, 컨테이너, 네트워크, 볼륨과 같은 도커 객체를 관리
- 데몬은 다른 데몬과 통신하여 도커 서비스를 관리할 수도 있음
### 도커 클라이언트 (도커 데스크탑..?)
- 많은 도커 사용자와 도커가 상호 작용하는 기본 방법 
-  “docker run”과 같은 명령을 사용하면, 클라이언트는 이러한 명령을 수행하도록 데몬(dockerd)에게 전송한다. 
-  도커 명령은 도커 API를 사용 
-  둘 이상의 데몬과 통신 가능
### 도커 레지스트리 (도커 허브)
- 도커 이미지를 저장
- 도커 허브는 누구나 사용할 수 있는 공개 레지스트리이며, 도커는 기본적으로 도커 허브에서 이미지를 찾음 

### 도커 객체
- 도커를 사용하면 이미지, 컨테이너, 네트워크, 볼륨, 플러그인 및 기타 개체를 만들고 사용하게 됨 
-  이미지 
	-  도커 컨테이너의 생성 지침이 포함된 읽기 전용 템플릿 
	-  도커 파일의 각 명령어는 이미지에 레이어(layer)를 만듦 
	-  도커 파일을 수정하고 이미지를 다시 빌드(build)하면, 변경된 레이어만 다시 빌드 됨
- 컨테이너 
	-  이미지의 실행 가능한 인스턴스 
	- 도커 API 또는 CLI를 사용하여 컨테이너를 생성, 시작, 중지, 이동, 삭제할 수 있음 
	-  컨테이너는 생성하거나 시작할 때 제공하는 구성 옵션과 이미지로 정의됨 
	-  컨테이너를 하나 이상의 네트워크에 연결하거나, 스토리지를 연결하거나, 현재 상태를 기반으로 새 이미지를 생성할 수도 있음 
	-  컨테이너가 제거되면 영구 저장소(볼륨)에 저장되지 않은 상태 변경사항이 모두 사라짐

## 도커 엔진의 기술 변화
초기 도커 엔진은 **리눅스 컨테이너**를 기반으로 작동했다.
Docker 이후로 컨테이너 런타임이 생겼고, 컨테이너 런타임에 대한 표준 인터페이스가 존재하지 않아 런타임별 서로 다른 인터페이스를 갖는 경우가 빈번하여 불편함.
따라서 컨테이너 형식 및 런타임에 대한 OCI(Open Container Initiative)를 구성 
0.9.0 이후에는 libcontainer OCI로 도커 엔진 구성
1.11.0 이후에는 도커 데몬, 컨테이너 데몬, runCOCI를 이용하여 컨테이너 관리
- 도커 데몬: 도커 CLI로부터 명령어를 수신하여 처리 
-  컨테이너 데몬: 컨테이너 런타임 툴 
	-  네트워크, 볼륨 등은 도커 데몬에 맡기고, 컨테이너 관리 기능만 가지고 있음 
-  runC: 컨테이너를 실제 생성하고 종료시키는 역할 수행. 
	-  호스트 OS에 대한 의존성을 제거하여 리눅스에 의존적인 문제 해결

## 도커 실행 원리
![[Pasted image 20230921032951.png]]
## 도커 명령어
`docker -v` : 도커 버전 정보 확인
`docker version` : 설치된 도커 엔진의 세부 정보 확인
`docker [image] pull [option] name:tag` : 레지스트리에서 이미지 다운로드
- image는 생략가능
`docker image ls [option][repository:tag]` = `docker images` : 도커 이미지 목록 나열
`docker image inspect [option] image` : Docker 객체(이미지, 컨테이너, 볼륨)에 대한 세부정보를 json 형식으로 반환
`docker image history [option] [image name]` : 이미지의 기록 조회 
- 현재 이미지를 구성을 위해 사용된 레이블 정보와 각 레이어의 수행 명령, 크기 등을 조회 가능
`docker image tag [old tag] [new tag]` : 도커 이미지 태그 설정
- 단순히 새로운 참조명을 붙이는 작업으로 이미지 id는 변경되지 않음
`docker image save [option] [image name]` : 도커 이미지를 tar 파일로 저장
ex ) `docker image save mysql:5.7 > test-mysql57.tar`
ex ) `docker image save mysql:5.7 | gzip > test-mysql57.tar.gz`
`docker image load [option]` : docker save로 저장한 tar 파일을 이미지로 불러옴
ex ) `docker image load < test-mysql57.tar`
`docker image rm [option] [image name]` = `docker rmi [option] [image name]` : 컨테이너가 실행 중이지 않은 도커 이미지 삭제
- 이미지 삭제 시 latest 버전을 제외한 나머지는 반드시 태그명을 명시해준다.
`docker image prune [OPTIONS]` : 컨테이너를 사용하지 않은 모든 이미지 제거
- -a 옵션을 이용하면 사용 중이 아닌 모든 이미지가 제



![[Pasted image 20230921033238.png]]