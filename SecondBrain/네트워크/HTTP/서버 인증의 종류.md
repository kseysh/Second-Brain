## Session/Cookie 방식
계정정보를 매번 요청에 넣어서 보내기엔 보안에 너무 취약합니다. 그래서 사용하는 방식이 Session / Cookie 방식입니다.
![[Pasted image 20230829151436.png]]

순서는 아래와 같습니다.
1. 사용자 로그인
2. 서버에서는 계정정보를 읽어 사용자를 확인 
3. 사용자의 고유한 ID값을 부여하여 세션 저장소에 저장한 후, 이와 연결되는 세션ID를 발행합니다.
4. 사용자는 서버에서 해당 세션ID를 받아 쿠키에 저장을 한 후, 인증이 필요한 요청마다 쿠키를 헤더에 실어 보냅니다.
5. 서버에서는 쿠키를 받아 세션 저장소에서 대조를 한 후 대응되는 정보를 가져옵니다.
6. 인증이 완료되고 서버는 사용자에 맞는 데이터를 보내줍니다.

세션 쿠키 방식의 인증은 기본적으로 세션 저장소를 필요로 하며 세션 저장소는 로그인을 했을 때 사용자의 정보를 저장하고 세션 ID를 이용해서 사용자 정보를 돌려줍니다. 인증의 책임을 서버가 지게 하도록 세션을 사용한다. 사용자가 해킹을 당하는 것 보다는 서버가 해킹을 당하는 것이 더 어렵기 때문입니다.

### 세션 쿠키 로그인의 장단점
#### 장점
1. 세션 쿠키 방식은 쿠키를 매개로 인증을 거치기 때문에 쿠키가 담긴 HTTP요청이 노출되더라도 쿠키 자체는 유의미한 값을 갖고 있지 않아 안전하다는 장점이 있습니다.
2. 서버에서 세션 ID 값을 받았을 때 일일히 회원정보를 확인할 필요없이 바로 어떤 회원인지를 확인할 수 있어 서버의 자원에 접근하기 용이합니다.
#### 단점
1. 만약 해커가 HTTP 요청에 있는 쿠키를 훔쳐 훔친 세션 ID를 이용해 HTTP 요청을 보내게 된다면 정보를 잘 못 보내줄 수도 있어 위험할 수 있다.
	1. 해결책 : HTTPS를 사용해 요청 자체를 탈취해도 안의 정보를 읽기 힘들게 한다.
	2. 세션ID에 유효시간을 넣어준다.
2. 세션 저장소를 사용하기 때문에 서버에서 추가적인 저장공간을 필요로 하게된다.
# 토큰 기반 인증 방식
JWT는 토큰 기반 인증방식의 대표적인 예라고 할 수 있습니다. Json Web Token의 약자로 인증에 플요한 정보들을 암호화시킨 토큰을 뜻합니다. 
[[JWT란]]
![[Pasted image 20230829160228.png]]

1. 사용자가 ID , PW를 통해 로그인합니다.
2. 서버에서는 회원 DB에서 값을 비교합니다(보통 PW는 일반적으로 암호화해서 들어갑니다)
3~4. 로그인이 완료되면 Access Token, Refresh Token을 발급합니다. 이때 일반적으로 회원DB에 Refresh Token을 저장해둡니다.
5. 사용자는 Refresh Token은 **안전한 저장소**에 저장 후, Access Token을 헤더에 실어 요청을 보냅니다.
6~7. Access Token을 검증하여 이에 맞는 데이터를 보냅니다.
8. 시간이 지나 Access Token이 만료됐다고 보겠습니다.
9. 사용자는 이전과 동일하게 Access Token을 헤더에 실어 요청을 보냅니다.
10~11. 서버는 Access Token이 만료됨을 확인하고 권한없음을 신호로 보냅니다.
### JWT 로그인의 장단점
#### 장점
1. 세션/쿠키와 달리 별도의 저장소의 관리가 필요없다.
2. Stateless한 인증을 구현할 수 있다.
3. 토큰 기반으로 하는 다른 인증 시스템에 접근이 가능하므로 확장성이 뛰어나다 예를 들어 소셜로그인이 있다.
#### 단점
1. 이미 발급된 JWT가 탈취당하면 악용되기 쉽다. 세션/쿠키의 경우 쿠키가 악용된다면 해당하는 세션ID를 지우면 되지만, JWT는 Stateless하므로 유효기간이 완료되기 전까지는 계속 사용이 가능하다. 
	1. 해결책 : Access Token의 유효기간을 줄이고, Refresh Token을 발급하여 Access Token이 탈취당하더라도 피해를 줄일 수 있도록 한다. 또한 Blacklist 기능을 활용한다.
2. Payload 정보가 제한적이다. Payload는 따로 암호화 되지 않아 디코딩 시 누구나 정보를 확인할 수 있다. (세션/쿠키 방식은 유저의 정보가 전부 서버의 저장소에 안전하게 보관된다. )따라서 유저의 중요한 정보를 Payload에 넣을 수 없다.
3. JWT가 암호화된다면 길이가 길어지게 되고 인증이 필요한 요청이 많아질수록 서버의 자원낭비가 발생하게 된다.