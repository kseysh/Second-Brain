### owner
• owner는 일반적으로 파일을 생성한 사용자입니다.
• owner의 실제 신원
	• 사용자 ID (종종 uid로 약칭됨)
	• 특정 사용자 이름과 연결된 uid
![[Pasted image 20241008152311.png|450]]
password는 다른 파일로 옮겨서 x로만 표기됨
• 각 UNIX 프로세스는 **일반적으로 해당 프로세스를 시작한 사용자의 uid와 연결**됩니다.
• 파일이 생성될 때, 시스템은 생성 프로세스의 uid를 참조하여 소유권을 설정합니다.
• 소유권 변경
	• 슈퍼유저 또는 파일의 소유자
	• 슈퍼유저(username=root, uid=0)
![[Pasted image 20241008191519.png]]
process를 실행한 사람의 uid가 프로세스에 기록됨 (프로세스가 shell의 uid를 상속함.)
### 그룹
• 각 사용자는 **적어도 하나 이상의 그룹**에 속해 있습니다.
```shell
$ usermod -G group1,group2 user1 // user modify user1의 그룹을 변경하는 중
$ id // 자신의 정보 출력
uid=509(user1) gid=509(group1) groups=509(group1),510(group2)
```
• `/etc/group`에 정의됨
• 그룹의 실제 신원
	• 그룹 ID (종종 gid로 약칭됨)
	• 특정 그룹 이름과 연결된 gid
• gid와 uid는 사용자가 시작한 프로세스에 의해 상속됩니다.
## 실제 사용자 및 그룹 ID
• 실제 사용자 ID (ruid) - 프로세스를 시작한 사용자의 uid
• 유효 사용자 ID (euid) - 특정 작업을 수행할 프로세스의 권한을 부여하는 데 사용됨
• 대부분의 경우, 유효 사용자 ID와 실제 사용자 ID는 일치합니다
• 유효 사용자 및 그룹 ID는 파일 접근 권한을 결정합니다.
![[Pasted image 20241008194513.png]]
euid를 이용해 /shadow파일을 변경하는 예제
## 권한 및 파일 모드
### 소유권
• 파일에 연결된 권한을 선택할 수 있음
### 권한
• 다른 사용자가 파일에 접근할 수 있는 방법을 결정함
• 슈퍼유저는 읽기, 쓰기 또는 실행 권한과 상관없이 모든 파일을 조작할 수 있음
![[Pasted image 20241008153427.png|300]]
![[Pasted image 20241008153504.png|300]]  
## open(2)와 파일 권한
• **파일을 열 때 커널은 euid 및 gid를 기반으로 접근 테스트를 수행**합니다.
## 파일 접근 테스트
• 커널이 수행하는 테스트는 다음과 같습니다.
	• 프로세스의 유효 사용자 ID가 0 (슈퍼유저)인 경우 접근이 허용됩니다.
	• 프로세스의 유효 사용자 ID가 파일의 소유자 ID와 같은 경우, 적절한 사용자 접근 권한 비트가 설정되어 있으면 접근이 허용됩니다. 그렇지 않으면 접근이 거부됩니다.
	• 프로세스의 유효 그룹 ID가 파일의 그룹 ID와 같은 경우, 적절한 그룹 접근 권한 비트가 설정되어 있으면 접근이 허용됩니다. 그렇지 않으면 접근이 거부됩니다
	• 적절한 다른 접근 권한 비트가 설정되어 있으면 접근이 허용됩니다. 그렇지 않으면 접근이 거부됩니다.
## 파일 생성 마스크
• 파일 생성 마스크 (보호)
	• 파일이 생성될 때 특정 권한 비트를 자동으로 해제합니다.
	• 지정된 권한이 실수로 켜지는 것을 방지합니다.
![[Pasted image 20241008162002.png|350]]
  위의 명령어로 실행해도 자연스럽게 아래 명령어로 실행됨 (마스크가 어떻게 설정되었느냐만 다를 뿐)
## chmod(2) 시스템 호출
```c
#include <unistd.h>
int chmod(const char *pathname, mode_t newmode);
// Returns: 0 if OK,-1 on error

// newmode에는 command의 chmod처럼 u+w 이런거는 못들어가고 777이런것만 들어갈 수 있음
```
• 기존 파일의 권한을 변경합니다. (change mode)
• 파일의 소유자(변경하려면 euid가 있어야 함) 또는 슈퍼유저만 가능합니다.
## chown(2) 시스템 호출
```c
#include <unistd.h>
int chown(const char *pathname, uid_t owner_id, gid_t group_id);
// Returns: 0 if OK,-1 on error
```
• 파일의 사용자 ID와 그룹 ID를 변경할 수 있습니다. (change owner)
• 인수
	• owner_id: 새로운 소유자 ID
	• group_id: 새로운 그룹 ID
• owner_id 또는 group_id 중 하나라도 -1인 경우, 해당 ID는 변경되지 않습니다. (안 바꾸고 싶으면 바꾸고 싶지 않은 것에 -1을 넣는다)
• 다른 owner의 파일 소유권을 변경하려는 시도 시 항상 **EPERM** 오류가 반환됩니다.
• **파일의 소유권이 변경되면 해당 파일의 set-user-id 및 set-group-id 권한이 해제**됩니다.
- 해제되지 않는다면, chown으로 다른 owner로 변경 후 그 파일을 이용해서 set-user-id로 owner가 볼 수 있는 모든 권한을 가져갈 수 있기 때문이다.